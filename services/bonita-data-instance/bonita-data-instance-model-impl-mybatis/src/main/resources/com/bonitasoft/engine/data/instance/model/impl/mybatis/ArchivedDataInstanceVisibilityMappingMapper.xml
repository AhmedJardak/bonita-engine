<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.bonitasoft.engine.data.instance.model.archive.impl.SADataInstanceVisibilityMappingImpl">

	<insert id="insertSADataInstanceVisibilityMappingImpl" parameterType="ArchDataInstanceVisibilityMapping">
		INSERT INTO arch_data_mapping (tenantid, id, containerId, containerType, dataName, dataInstanceId, archiveDate, sourceObjectId)
		VALUES (#{tenantid}, #{entity.id}, #{entity.containerId}, #{entity.containerType}, #{entity.dataName}, #{entity.dataInstanceId}, #{entity.archiveDate}, #{entity.sourceObjectId})
	</insert>

	<delete id="deleteSADataInstanceVisibilityMappingImpl" parameterType="ArchDataInstanceVisibilityMapping">
		DELETE FROM arch_data_mapping
		WHERE tenantid = #{tenantid}
		AND id = #{id}
	</delete>

	<resultMap id="archDataInstanceVisibilityMappingResultMap" type="ArchDataInstanceVisibilityMapping">
		<result property="id" column="id" />
		<result property="containerId" column="containerId" />
		<result property="containerType" column="containerType" />
		<result property="dataName" column="dataName" />
		<result property="dataInstanceId" column="dataInstanceId" />
		<result property="archiveDate" column="archiveDate" />
		<result property="sourceObjectId" column="sourceObjectId" />
	</resultMap>

  	<select id="getSADataInstanceIdFromMapping" parameterType="long" resultType="long">
		SELECT dataMapping.dataInstanceId
		FROM arch_data_mapping dataMapping
		WHERE dataMapping.tenantid = #{tenantid}
		AND dataMapping.dataName = #{dataName}
		AND dataMapping.containerType = #{containerType}
		AND dataMapping.containerId = #{containerId}
		<if test="orderBy != null">
			ORDER BY ${orderBy}
		</if>
	</select>

  	<select id="getSADataInstanceIdsFromMapping" parameterType="long" resultType="long">
		SELECT dataMapping.dataInstanceId
		FROM arch_data_mapping dataMapping
		WHERE dataMapping.tenantid = #{tenantid}
		AND dataMapping.dataName IN
		<foreach item="dataName" index="index" collection="dataNames" open="(" separator="," close=")">
				#{dataName}
		</foreach>
		AND dataMapping.containerType = #{containerType}
		AND dataMapping.containerId = #{containerId}
		<if test="orderBy != null">
			ORDER BY ${orderBy}
		</if>
	</select>

  	<select id="getSADataInstanceVisibilityMappings" parameterType="long" resultMap="archDataInstanceVisibilityMappingResultMap">
		SELECT *
		FROM arch_data_mapping dataMapping
		WHERE dataMapping.tenantid = #{tenantid}
		AND dataMapping.containerType = #{containerType}
		AND dataMapping.containerId = #{containerId}
		<if test="orderBy != null">
			ORDER BY ${orderBy}
		</if>
	</select>

</mapper>