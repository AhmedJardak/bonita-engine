<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.bonitasoft.engine.data.instance.model.impl.SDataInstanceImpl">
    <cache/>
	<insert id="insertSBooleanDataInstanceImpl" parameterType="BooleanDataInstance">
		INSERT INTO data_instance (tenantid, id, name, description, transientData, className, containerId, containerType, namespace, element,
			intValue, longValue, shortTextValue, booleanValue, doubleValue, floatValue, blobValue, clobValue, discriminant)
		VALUES (#{tenantid}, #{entity.id}, #{entity.name}, #{entity.description}, #{entity.transientData}, #{entity.className}, #{entity.containerId},
			#{entity.containerType}, NULL, NULL, NULL, NULL, NULL, #{entity.value}, NULL, NULL, NULL, NULL, 'SBooleanDataInstanceImpl')
	</insert>

	<insert id="insertSIntegerDataInstanceImpl" parameterType="IntegerDataInstance">
		INSERT INTO data_instance (tenantid, id, name, description, transientData, className, containerId, containerType, namespace, element,
			intValue, longValue, shortTextValue, booleanValue, doubleValue, floatValue, blobValue, clobValue, discriminant)
		VALUES (#{tenantid}, #{entity.id}, #{entity.name}, #{entity.description}, #{entity.transientData}, #{entity.className}, #{entity.containerId},
			#{entity.containerType}, NULL, NULL, #{entity.value}, NULL, NULL, NULL, NULL, NULL, NULL,NULL, 'SIntegerDataInstanceImpl')
	</insert>

	<insert id="insertSLongDataInstanceImpl" parameterType="LongDataInstance">
		INSERT INTO data_instance (tenantid, id, name, description, transientData, className, containerId, containerType, namespace, element,
			intValue, longValue, shortTextValue, booleanValue, doubleValue, floatValue, blobValue, clobValue, discriminant)
		VALUES (#{tenantid}, #{entity.id}, #{entity.name}, #{entity.description}, #{entity.transientData}, #{entity.className}, #{entity.containerId},
			#{entity.containerType}, NULL, NULL, NULL, #{entity.value}, NULL, NULL, NULL, NULL, NULL, NULL, 'SLongDataInstanceImpl')
	</insert>

	<insert id="insertSShortTextDataInstanceImpl" parameterType="ShortTextDataInstance">
		INSERT INTO data_instance (tenantid, id, name, description, transientData, className, containerId, containerType, namespace, element,
			intValue, longValue, shortTextValue, booleanValue, doubleValue, floatValue, blobValue, clobValue, discriminant)
		VALUES (#{tenantid}, #{entity.id}, #{entity.name}, #{entity.description}, #{entity.transientData}, #{entity.className}, #{entity.containerId},
			#{entity.containerType}, NULL, NULL, NULL, NULL, #{entity.value}, NULL, NULL, NULL, NULL, NULL, 'SShortTextDataInstanceImpl')
	</insert>

	<insert id="insertSDoubleDataInstanceImpl" parameterType="DoubleDataInstance">
		INSERT INTO	data_instance (tenantid, id, name, description, transientData, className, containerId, containerType, namespace, element,
			intValue, longValue, shortTextValue, booleanValue, doubleValue, floatValue, blobValue, clobValue, discriminant)
		VALUES (#{tenantid}, #{entity.id}, #{entity.name}, #{entity.description}, #{entity.transientData}, 	#{entity.className}, #{entity.containerId},
			#{entity.containerType}, NULL, NULL, NULL, NULL, NULL, NULL, #{entity.value}, NULL, NULL, NULL, 'SDoubleDataInstanceImpl')
	</insert>
	
	<insert id="insertSFloatDataInstanceImpl" parameterType="FloatDataInstance">
		INSERT INTO	data_instance (tenantid, id, name, description, transientData, className, containerId, containerType, namespace, element,
			intValue, longValue, shortTextValue, booleanValue, doubleValue, floatValue, blobValue, clobValue, discriminant)
		VALUES (#{tenantid}, #{entity.id}, #{entity.name}, #{entity.description}, #{entity.transientData}, 	#{entity.className}, #{entity.containerId},
			#{entity.containerType}, NULL, NULL, NULL, NULL, NULL, NULL, NULL, #{entity.value}, NULL, NULL, 'SFloatDataInstanceImpl')
	</insert>

	<insert id="insertSBlobDataInstanceImpl" parameterType="BlobDataInstance">
		INSERT INTO data_instance (tenantid, id, name, description, transientData, className, containerId, containerType, namespace, element,
			intValue, longValue, shortTextValue, booleanValue, doubleValue, floatValue, blobValue, clobValue, discriminant)
		VALUES (#{tenantid}, #{entity.id}, #{entity.name}, #{entity.description}, #{entity.transientData}, #{entity.className}, #{entity.containerId},
			#{entity.containerType}, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, #{entity.value, typeHandler=org.bonitasoft.engine.persistence.SerializableTypeHandler},
			NULL, 'SBlobDataInstanceImpl')
	</insert>

	<insert id="insertSLongTextDataInstanceImpl" parameterType="LongTextDataInstance">
		INSERT INTO data_instance (tenantid, id, name, description, transientData, className, containerId, containerType, namespace, element,
			intValue, longValue, shortTextValue, booleanValue, doubleValue, floatValue, blobValue, clobValue, discriminant)
		VALUES (#{tenantid}, #{entity.id}, #{entity.name}, #{entity.description}, #{entity.transientData}, #{entity.className}, #{entity.containerId},
			#{entity.containerType}, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, #{entity.value}, 'SLongTextDataInstanceImpl')
	</insert>

	<insert id="insertSXMLDataInstanceImpl" parameterType="XMLDataInstance">
		INSERT INTO data_instance (tenantid, id, name, description, transientData, className, containerId, containerType, namespace, element,
			intValue, longValue, shortTextValue, booleanValue, doubleValue, floatValue, blobValue, clobValue, discriminant)
		VALUES (#{tenantid}, #{entity.id}, #{entity.name}, #{entity.description}, #{entity.transientData},#{entity.className}, #{entity.containerId},
			#{entity.containerType}, #{entity.namespace}, #{entity.element}, NULL, NULL, NULL, NULL, NULL, NULL, NULL, #{entity.value}, 'SXMLDataInstanceImpl')
	</insert>

	<update id="updateSDataInstanceImpl" parameterType="DataInstance">
		UPDATE data_instance
		<trim prefix="SET" suffixOverrides=",">
			<if test="name == '___bonitanull___'">name=NULL,</if>
			<if test="name != null and name != '___bonitanull___'">name=#{name},</if>
			<if test="transientData!= null">transientData=#{transientData},</if>
			<if test="className != null and className != '___bonitanull___'">className=#{className},</if>
			<if test="description == '___bonitanull___'">description=NULL,</if>
			<if test="description != null and description != '___bonitanull___'">description=#{description},</if>
			<if test="discriminant == 'SIntegerDataInstanceImpl' and value != null">intValue=#{value},</if>
			<if test="discriminant == 'SLongDataInstanceImpl' and value != null">longValue=#{value},</if>
			<if test="discriminant == 'SDoubleDataInstanceImpl' and value != null">doubleValue=#{value},</if>
			<if test="discriminant == 'SFloatDataInstanceImpl' and value != null">floatValue=#{value},</if>
			<if test="discriminant == 'SShortTextDataInstanceImpl' and value == '___bonitanull___'">shortTextValue=NULL,</if>
			<if test="discriminant == 'SShortTextDataInstanceImpl' and value != null and value != '___bonitanull___'">shortTextValue=#{value},</if>
			<if test="discriminant == 'SBooleanDataInstanceImpl' and value != null">booleanValue=#{value},</if>
			<if test="discriminant == 'SLongTextDataInstanceImpl' and value == '___bonitanull___'">clobValue=NULL,</if>
			<if test="discriminant == 'SLongTextDataInstanceImpl' and value != null and value != '___bonitanull___'">clobValue=#{value},</if>
			<if test="discriminant == 'SBlobDataInstanceImpl' and value == '___bonitanull___'">blobValue=NULL,</if>
			<if test="discriminant == 'SBlobDataInstanceImpl' and value != null and value != '___bonitanull___'">blobValue=#{value, typeHandler=org.bonitasoft.engine.persistence.SerializableTypeHandler}</if>
			<if test="discriminant == 'SXMLDataInstanceImpl' and value == '___bonitanull___'">clobValue=NULL,</if>
			<if test="discriminant == 'SXMLDataInstanceImpl' and value != null and value != '___bonitanull___'">clobValue=#{value},</if>
		</trim>
		WHERE tenantid = #{tenantid}
		AND id = #{id}
	</update>

	<delete id="deleteSDataInstanceImpl" parameterType="DataInstance">
		DELETE FROM data_instance
		WHERE tenantid = #{tenantid}
		AND id = #{id}
	</delete>

	<resultMap id="dataInstanceResultMap" type="DataInstance">
		<result property="id" column="id" />
		<result property="name" column="name" />
		<result property="description" column="description" />
		<result property="transientData" column="transientData" />
		<result property="className" column="className" />
		<result property="containerId" column="containerId" />
		<result property="containerType" column="containerType" />
		<discriminator javaType="string" column="discriminant">
			<case value="SIntegerDataInstanceImpl" resultType="IntegerDataInstance">
				<result property="value" javaType="int" column="intValue" />
			</case>
			<case value="SLongDataInstanceImpl" resultType="LongDataInstance">
				<result property="value" javaType="long" column="longValue" />
			</case>
			<case value="SDoubleDataInstanceImpl" resultType="DoubleDataInstance">
				<result property="value" javaType="double" column="doubleValue" />
			</case>
			<case value="SFloatDataInstanceImpl" resultType="FloatDataInstance">
				<result property="value" javaType="float" column="floatValue" />
			</case>
			<case value="SShortTextDataInstanceImpl" resultType="ShortTextDataInstance">
				<result property="value" javaType="string" column="shortTextValue" />
			</case>
			<case value="SBooleanDataInstanceImpl" resultType="BooleanDataInstance">
				<result property="value" javaType="boolean" jdbcType="BOOLEAN" column="booleanValue" />
			</case>
			<case value="SLongTextDataInstanceImpl" resultType="LongTextDataInstance">
				<result property="value" javaType="string" jdbcType="CLOB" column="clobValue" />
			</case>
			<case value="SXMLDataInstanceImpl" resultType="XMLDataInstance">
				<result property="value" javaType="string" jdbcType="CLOB" column="clobValue" />
				<result property="namespace" column="namespace" />
				<result property="element" column="element" />
			</case>
			<case value="SBlobDataInstanceImpl" resultType="BlobDataInstance">
				<result property="value" typeHandler="org.bonitasoft.engine.persistence.SerializableTypeHandler" jdbcType="BLOB" column="blobValue" />
			</case>
			<case value="SDateDataInstanceImpl" resultType="DateDataInstance">
				<result property="value" javaType="long" column="longValue" />
			</case>
		</discriminator>
	</resultMap>

	<select id="getDataInstanceById" parameterType="long" resultMap="dataInstanceResultMap">
		SELECT *
		FROM data_instance dataInst
		WHERE dataInst.tenantid = #{tenantid}
		AND dataInst.id = #{id}
		<if test="orderBy != null">
			ORDER BY ${orderBy}
		</if>
	</select>

	<select id="getDataInstanceByIds" parameterType="long" resultMap="dataInstanceResultMap">
		SELECT *
		FROM data_instance dataInst
		WHERE dataInst.tenantid = #{tenantid}
		AND dataInst.id IN
		<foreach item="id" index="index" collection="ids" open="(" separator="," close=")">
				#{id}
		</foreach>
		<if test="orderBy != null">
			ORDER BY ${orderBy}
		</if>
	</select>

	<select id="getDataInstancesByNameAndContainer" resultMap="dataInstanceResultMap">
		SELECT *
		FROM data_instance dataInst
		WHERE dataInst.tenantid = #{tenantid}
		AND dataInst.name = #{name}
		AND dataInst.containerId = #{containerId}
		AND dataInst.containerType = #{containerType}
	</select>
	
	<select id="getDataInstancesByContainer" resultMap="dataInstanceResultMap">
		SELECT *
		FROM data_instance dataInst
		WHERE dataInst.tenantid = #{tenantid}
		AND dataInst.containerId = #{containerId}
		AND dataInst.containerType = #{containerType}
	</select>

</mapper>