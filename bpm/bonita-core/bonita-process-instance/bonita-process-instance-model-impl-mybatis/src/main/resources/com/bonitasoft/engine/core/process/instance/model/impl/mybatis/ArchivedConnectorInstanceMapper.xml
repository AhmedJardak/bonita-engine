<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.bonitasoft.engine.core.process.instance.model.archive.impl.SAConnectorInstanceImpl">

	<insert id="insertSAConnectorInstanceImpl" parameterType="transition_instance">
		INSERT INTO arch_connector_instance (tenantid, id, containerId, containerType, connectorId, version, name, activationEvent, state, archiveDate, sourceObjectId)
		VALUES (#{tenantid}, #{entity.id}, #{entity.containerId}, #{entity.containerType}, #{entity.connectorId}, #{entity.version}, #{entity.name},
			#{entity.activationEvent}, #{entity.state}, #{entity.archiveDate}, #{entity.sourceObjectId})
	</insert>

	<update id="updateSAConnectorInstanceImpl" parameterType="arch_connector_instance">
		UPDATE arch_connector_instance
	    <set>
	      <if test="name != null">name=#{name},</if>
	      <if test="state != null">state=#{state}</if>
	    </set>
	    WHERE tenantid = #{tenantid}
	    AND id = #{id}
	</update>

	<delete id="deleteSAConnectorInstanceImpl" parameterType="arch_connector_instance">
		DELETE FROM arch_connector_instance
		WHERE tenantid = #{tenantid}
		AND id = #{id}
	</delete>

	<resultMap id="archConnectorInstanceResultMap" type="arch_connector_instance">
		<result property="id" column="id" />
		<result property="name" column="name" />
		<result property="containerId" column="containerId" />
		<result property="containerType" column="containerType" />
		<result property="connectorId" column="connectorId" />
		<result property="version" column="version" />
		<result property="activationEvent" column="activationEvent" />
		<result property="state" column="state" />
		<result property="archiveDate" column="archiveDate" />
		<result property="sourceObjectId" column="sourceObjectId" />
	</resultMap>

	<select id="getNumberOfSAConnectorInstance" parameterType="long" resultType="long">
		SELECT COUNT(ac.id)
		FROM arch_connector_instance ac
		WHERE ac.tenantid = #{tenantid}
		
		<if test="filter != null">
			AND ${filter}
		</if>		
	</select>
	
	<select id="searchSAConnectorInstance" resultMap="archConnectorInstanceResultMap">
		SELECT ac.*
		FROM arch_connector_instance ac
		WHERE ac.tenantid = #{tenantid}
		
		<if test="filter != null">
			AND ${filter}
		</if>
		<if test="orderBy != null">
			ORDER BY ${orderBy}
		</if>		
	</select>	

</mapper>